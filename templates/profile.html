{% extends 'base.html' %}
{% block content %}
 
    <a href="/homepage">
      <button type="button" class="btn btn-outline-primary">Home</button>
    </a>   

    <div id="profile" style="width: 18rem;">
    <p> <img src="/static/uploads/{{ user_info.profile.filename }}" class="profile_pic" alt="image">



      <div class="card-body">
        <h4 class="user-name">{{user_info.fname}}{{user_info.lname}}</h4>
        <p>Age:{{user_info.age}}</p>
        <p>City:{{user_info.city}}</p>
        <p>Hobbies:
       {% for hobbie in user_info.hobbies %}
        <li>{{hobbie.hobbie_name}}</li>
        {% endfor %}

        <p>About me: {{user_info.yourself}}</p>
        
        <p class="card-text">Search People, Connect, Talk and Meet at Caffe</p>
      </div>
    </div>
    
    <button
      id="like"
      data-liked-user-id='{{ user_info.user_id }}'
      type="button"
      class="btn btn-outline-info{% if status == 'liked' %} liked{% endif %}">Like</button>
    
    <button
      id="dislike"
      data-disliked-user-id='{{ user_info.user_id }}'
      type="button"
      class="btn btn-outline-info{% if status == 'disliked' %} disliked{% endif %}">Dislike</button>

    <!-- Show contact of user -->
    <p id="phone"> {{user_info.contact_no}}</p>

  <script>

    
    "use strict"; //

    let phone = $('#phone'); //id of p tage to show phone no.
  //converts the given object into JSON, useful to generate JavaScript on the fly
    let hasMatched = ({{ matched|tojson }}); //get data from flask to JS to see 
                                            //user already liked this person back

    if (hasMatched){    // 1.if ALREADY matched -show number
      phone.show() 
    }; 

    let likeButton = $('#like');
    let dislikeButton = $('#dislike');

    function likeResult(data) {
      console.log(data);
      likeButton.addClass('liked');
      dislikeButton.removeClass('disliked');

      // if liked_back is true, phone.show();
      if (data.liked_back == true){
        // phone.html()
        phone.show(); //2. if user LIKED BACK ,show phone number
      }
        
    }

    function unlikeResult(data) {
      likeButton.removeClass('liked');
      console.log(data)
      phone.hide();         //hide phone when user unlikes
    }
//#########################################################################

    function processLikedclick() {
      if (likeButton.hasClass('liked')) {
        // unlike
        $.post('/unlike', likeButton.data(), unlikeResult); // data looks like this... {likedUserId: 9}
      } else {
        // like
        $.post('/like', likeButton.data(), likeResult());
             // route, data from button(id), callback()
      }
    }
    likeButton.on('click', processLikedclick);

//#########################################################################
    function processDislikedclick(){ 
      if (dislikeButton.hasClass('disliked')){
        // undislike
        dislikeButton.removeClass('disliked');
                              //  data looks like this... {dislikedUserId: 9}
        $.post('/undislike',dislikeButton.data(), function(data) {console.log(data); });
      } else{
        // dislike
        dislikeButton.addClass('disliked');
        $.post('/dislike',dislikeButton.data(), unlikeResult());
              // route, data from button(id), callback()
       }
    }
    dislikeButton.on('click', processDislikedclick);
//#########################################################################

  </script>

{% endblock %}